<!--
  FSD Localization Subsystem
  定位子系统：KD-tree 定位、状态估计
-->
<launch>
    <arg name="use_eskf" default="false" doc="使用 ESKF 滤波器"/>
    <arg name="mode" default="track" doc="赛道模式: accel | skidpad | track"/>
    <arg name="mission_config" default="" doc="任务级参数覆盖文件（mission overlay）"/>
    <arg name="vehicle" default="A13" doc="车辆型谱ID"/>
    <arg name="vehicle_config" default="$(find fsd_launch)/config/vehicles/$(arg vehicle)/localization.yaml"/>
    <arg name="vehicle_local_config" default="" doc="本地覆盖参数文件（*.local.yaml）"/>

    <!-- Vehicle profile overlay (global ns; location/state_estimator 均可读取) -->
    <rosparam command="load" file="$(arg vehicle_config)"/>
    <rosparam if="$(eval arg('vehicle_local_config') != '')" command="load" file="$(arg vehicle_local_config)"/>

    <!-- Location KD-Tree -->
    <!-- 将 location_node 期望的 sensors/ins 重映射到 ins_bridge 发布的 /pbox_pub/Ins -->
    <group>
        <remap from="sensors/ins" to="/pbox_pub/Ins"/>
        <include unless="$(arg use_eskf)" file="$(find localization_ros)/launch/location.launch">
            <arg name="mode" value="$(arg mode)"/>
            <arg name="extra_config" value="$(arg mission_config)"/>
            <arg name="bag" value=""/>
        </include>
    </group>

    <!-- Location ESKF (可选) -->
    <include if="$(arg use_eskf)" file="$(find localization_ros)/launch/location_eskf.launch">
        <arg name="mode" value="$(arg mode)"/>
        <arg name="extra_config" value="$(arg mission_config)"/>
        <arg name="bag" value=""/>
    </include>
</launch>
