<!--
  FSD Planning Subsystem
  规划子系统：统一路径规划管线
  
  Phase 3 Cleanup: Removed legacy planner selection (high_speed/line/skidpad).
  Only unified pipeline and none option remain.
-->
<launch>
    <arg name="mission" default="high_speed" doc="Mission type: high_speed, line, skidpad"/>
    <arg name="planner" default="unified" doc="planner type: unified | none (none for EBS test)"/>
    <arg name="output_pathlimits_topic" default="planning/pathlimits" doc="规划输出 PathLimits 话题（canonical）"/>
    <arg name="input_car_state_topic" default="localization/car_state" doc="规划输入车辆状态话题（canonical）"/>
    <arg name="output_approaching_goal_topic" default="planning/skidpad/approaching_goal" doc="八字模式接近终点输出话题（canonical）"/>
    <arg name="diagnostics_topic" default="planning/diagnostics" doc="规划入口诊断本地话题"/>
    <arg name="publish_global_diagnostics" default="true" doc="规划是否发布到统一 /diagnostics"/>
    <arg name="global_diagnostics_topic" default="/diagnostics" doc="规划统一诊断总线话题"/>
    <arg name="diagnostics_rate_hz" default="1.0" doc="规划入口诊断发布频率"/>
    <arg name="enable_internal_viz_side_channel" default="false" doc="规划内部可视化侧通道（兼容链路，默认关闭）"/>
    <arg name="vehicle" default="A13" doc="车辆型谱ID"/>
    <arg name="vehicle_config" default="$(find fsd_launch)/config/vehicles/$(arg vehicle)/planning.yaml"/>
    <arg name="vehicle_local_config" default="" doc="本地覆盖参数文件"/>

    <!-- Unified Planning Pipeline -->
    <include if="$(eval arg('planner') == 'unified')" file="$(find planning_ros)/launch/planning_pipeline.launch">
        <arg name="mission" value="$(arg mission)"/>
        <arg name="output_pathlimits_topic" value="$(arg output_pathlimits_topic)"/>
        <arg name="input_car_state_topic" value="$(arg input_car_state_topic)"/>
        <arg name="output_approaching_goal_topic" value="$(arg output_approaching_goal_topic)"/>
        <arg name="diagnostics_topic" value="$(arg diagnostics_topic)"/>
        <arg name="publish_global_diagnostics" value="$(arg publish_global_diagnostics)"/>
        <arg name="global_diagnostics_topic" value="$(arg global_diagnostics_topic)"/>
        <arg name="diagnostics_rate_hz" value="$(arg diagnostics_rate_hz)"/>
        <arg name="enable_internal_viz_side_channel" value="$(arg enable_internal_viz_side_channel)"/>
        <arg name="vehicle_config" value="$(arg vehicle_config)"/>
        <arg name="vehicle_local_config" value="$(arg vehicle_local_config)"/>
    </include>

    <!-- None: for EBS test without planning -->
    <group if="$(eval arg('planner') == 'none')">
        <node pkg="rospy" type="message" name="planning_disabled_notice" output="screen"
              args="Planning disabled (planner:=none) - EBS test mode"/>
    </group>
</launch>
